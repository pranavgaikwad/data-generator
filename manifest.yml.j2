---
apiVersion: v1
kind: Namespace
metadata:
  name: {{ namespace }}
{% for i in range(number_of_files|int) %}
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: "pvc-{{ i }}"
  namespace: {{ namespace }}
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: {{ pvc_size }}
{% endfor %}
---
apiVersion: v1
kind: Pod
metadata:
  name: pvc-migrate-bmark
  namespace: {{ namespace }}
spec:
  volumes:
{% for i in range(number_of_files|int) %}
  - name: "vol-{{ i }}" 
    persistentVolumeClaim:
      claimName: "pvc-{{ i }}"
{% endfor %}
  containers:
  - name: data-gen-bmark
    imagePullPolicy: Always
    image: {{ image }}
    volumeMounts:
{% for i in range(number_of_files|int) %}
    - mountPath: "/opt/mounts/mnt{{ i+1 }}"
      name: "vol-{{ i }}"
{% endfor %}
    env:
    - name: MAX_FILES
      value: "{{ max_files }}"
    - name: MIN_FILES
      value: "{{ min_files }}"
    - name: NO_OF_MOUNTS
      value: "{{ number_of_files }}"
    - name: SIZE_EACH_MOUNT
      value: "{{ file_size }}"
